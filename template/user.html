<%inherit file="base.html"/>

<%!

import datetime

%>

<%def name="title()">${user.name}</%def>

<%def name="page()">

<h1>
  <a
     href="${url_rewrite("/user/%d" % user.user_id)}"
     >${user.name}</a>
</h1>

<div class="user-icon">
  <% hash = user.auth.gravatar_hash %>
  <img width="96px" height="96px"
       src="http://gravatar.com/avatar/${hash}?d=identicon&s=96">
  %if user == current_user:
  <p>Icon generated by <a href="http://www.gravatar.com/">Gravatar.com</a>.</p>
  <p><a href="http://www.gravatar.com/">Sign in or register there</a> to change it.</p>
  %endif
</div>

%if not moderator:
<div class="user-introduction">
  <h2>Welcome to CAAT's mapping application</h4>
  <p>You can now submit information about organisations and events, which will be reviewed by our moderators.</p>
  <p>To enable adding content, click the <strong>Edit</strong> button above.</p>
  <p>When browsing the site in edit mode, you'll see buttons for adding organisations, events, addresses and notes.</p>
  <p>When you've finished adding content, click the <strong>Browse</strong> button to return to normal viewing mode.</p>
  <p>This page shows you a list of your submissions. You can click your username above at any time to return here and see their progress or make further changes.</p>
</div>
%endif

<div class="user-entities">
%if moderator:
  <h3>Edit history</h3>

<table class="history">
  <thead>
    <tr>
      <th class="type">Type</th>
      <th class="id">ID</th>
      <th class="content">Content</th>
      <th class="user">User</th>
      <th class="date">Date</th>
    </tr>
  </thead>
  <tbody>
    %for entity in history:
<%
link = url_rewrite("/%s/%s" % (entity.type, entity.entity_id))
user_link = url_rewrite("/user/%s" % (entity.user_id))
%>
    <tr>
      <td class="type"><a href="${link}">${entity.type}</a></td>
      <td class="id"><a href="${link}">${"%d%s" % (entity.entity_id, entity.entity_v_id and ":%d" % entity.entity_v_id or "")}</a></td>
      <td class="content"><a href="${link}">${entity_name(entity)}</a></td>
      <td class="user">
        <a href="${user_link}">
	  <img width="24px" height="24px"
	       src="http://gravatar.com/avatar/${entity.gravatar_hash}?d=identicon&s=24">
	  ${entity.user_name}
        </a>
      </td>
      <td class="date">${datetime.datetime.fromtimestamp(entity.date).strftime("%Y/%m/%d %H:%M:%S")}</td>
    </tr>
    %endfor
  </tbody>
</table>
  
%else:
  <h3>Submissions</h3>
  <p>Your submissions will be shown here until they have been reviewed by our moderators.</p>
  <p>Click on any of them to view or make further changes.</p>
  <div class="org">
    <h3>Organisations</h4>
<ul>
%for org in submissions["org"]:
<li>
  <a
     href="${url_rewrite(org.url)}"
     >${org.name}</a>
</li>
%endfor
</ul>
    <h4>Addresses</h4>
    <h4>Notes</h4>
  </div>
  <div class="event">
    <h3>Events</h4>
<ul>
%for event in submissions["event"]:
<li>
  <a
     href="${url_rewrite(event.url)}"
     >${event.name}</a>
</li>
%endfor
</ul>
    <h4>Addresses</h4>
    <h4>Notes</h4>
  </div>
%endif
</div>

</%def>

</body>

</html>


<%def name="entity_name(entity)">
%if entity.type == "address":
${entity.name | n, h, unicode, newline_comma}
%else:
${entity.name | n, h, unicode}
%endif
<% return "" %>
</%def>



