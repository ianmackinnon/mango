<%inherit file="base.html"/>

<%def name="title()"><%
return user.name
%></%def>

<%def name="logout_url()"><% return "/" %></%def>

<%def name="page()">

<h1>
  <a
     href="${url_rewrite("/user/%d" % user.user_id)}"
     >${user.name}</a>
</h1>

<div class="user-icon">
  <% hash = user.gravatar_hash() %>
  <img width="96px" height="96px"
       src="${protocol}://gravatar.com/avatar/${hash}?d=identicon&s=96">
  %if user == current_user:
  <p>Icon generated by <a href="http://www.gravatar.com/">Gravatar.com</a>.</p>
  <p><a href="${protocol}://www.gravatar.com/">Sign in or register there</a> to change it.</p>
  %endif
</div>

%if not moderator:
<div class="user-introduction">
  <h2>Welcome to CAAT's mapping application</h4>
  <p>You can now submit information about companies and events, which will be reviewed by our moderators.</p>
  <p>Use the buttons in the top right to change between <strong>Edit</strong> and <strong>Browse</strong> modes (you must be in edit mode to add content).</p>
  <p>Your submissions will be shown here until they have been reviewed. Click on any of them to view or make further changes.</p>
</div>
%endif

<div class="user-entities">
%if moderator:
  <h3>Edit history</h3>

${self.mini.history_table(history, user=False)}

%else:
  <h3>Submissions</h3>
  <div class="org">
    <h3>Companies</h3>
    <a class="action" href="${url_rewrite("/organisation/new?view=edit")}">Add a new company</a>
    <ul>
      %for org in submissions["org"]:
      <li>
        <a
           href="${url_rewrite(org.url)}"
           >${org.name}</a>
      </li>
      %endfor
    </ul>
  </div>
  <div class="event">
    <h3>Events</h3>
    <a class="action" href="${url_rewrite("/event/new?view=edit")}">Add a new event</a>
    <ul>
      %for event in submissions["event"]:
      <li>
        <a
           href="${url_rewrite(event.url)}"
           >${event.name}</a>
      </li>
      %endfor
    </ul>
  </div>
  <div class="address">
    <h3>Addresses</h3>
    <ul>
      %for address in submissions["address"]:
      <li>
        <a
           href="${url_rewrite(address.url)}"
           >${address.postal}</a>
      </li>
      %endfor
    </ul>
  </div>
  %endif
</div>

</%def>






