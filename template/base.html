%if header1:
${header1.replace("/render-header-footer.php", uri) | n}
%else:
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset=utf-8 />
  <link rel="stylesheet" type="text/css" href="${url_root}static/jquery-ui/jquery-ui.css" />
%endif

  <title>${self.title()}</title>
  <link rel="stylesheet" type="text/css" href="${url_root}static/tag-it.css" />
  <link rel="stylesheet" type="text/css" href="${url_root}static/style.css" />
 
%if header2:
${header2.replace("/render-header-footer.php", uri) | n}
<div id="caat-page-links">
<a href="${url_root}about-this-map.php">About the map</a> |
<a href="${url_root}why-take-action.php">Why take action?</a> |
<a href="${url_root}expose-the-arms-trade.php">Expose the arms trade</a> | 
<a href="${url_root}creative-action.php">Creative action</a> |
<a href="${url_root}make-links-with-others.php">Make links with others</a> | 
<a href="${url_root}doing-more-digging.php">Doing more digging</a> | 
<a href="${url_root}event">Events</a> | 
<a href="${url_root}submit.php">Submit content</a>
</div>

%else:
</head>

<body>
%endif

<div id="mango">

  %if messages:
  <table>
    <tbody>
      %for message in messages:
      <tr><td>${message[1]}</td></tr>
      %endfor
    </tbody>
  </table>
  %endif

  <nav>
    <a href="${url_rewrite("/", parameters)}">Arms trade map</a>
    <div class="nav-group">
      <a href="${url_rewrite("/organisation", parameters)}">Organisations</a><a href="${url_rewrite("/organisation-tag", parameters)}">Tags</a>
    </div>
    <div class="nav-group">
      <a href="${url_rewrite("/event", parameters)}">Events</a><a href="${url_rewrite("/event-tag", parameters)}">Tags</a>
    </div>
    <a href="${url_rewrite("/note", parameters)}">Notes</a>
    %if current_user:
    |
    <a href="${url_rewrite("/user", parameters)}">Users</a>
    <a href="${url_rewrite("/history", parameters)}">History</a>
    <a href="${url_rewrite("/task/address", parameters)}">Addresses</a>
    %endif
  </nav>
    
  <div id="account">
    %if current_user:
    <a href="${url_rewrite("/user/%d" % current_user.user_id, parameters)}">
      <% hash = current_user.auth.gravatar_hash %>
      <img width="24px" height="24px"
	   src="http://gravatar.com/avatar/${hash}?d=identicon&s=24">
      ${current_user.name}
    </a>
    <a href="${url_rewrite("/auth/logout", {"next": url_rewrite(uri)})}">Log out</a>
    %else:
    <a href="${url_rewrite("/auth/login", {"next": url_rewrite(uri)})}">Log in</a>
    %endif
  </div>

  %if current_user:
  <div id="visibility">
    Visibility:
    <a href="${query_rewrite({"visibility":"public"})}"
       class="visibility-button\
${(parameters.get("visibility", "public")=="public") and " selected" or "" | n}"
       id="visibility-public"
       >Public</a>
    <a href="${query_rewrite({"visibility":"private"})}"
       class="visibility-button\
${parameters.get("visibility", "public")=="private" and " selected" or "" | n}"
       id="visibility-private"
       >Private</a>
    <a href="${query_rewrite({"visibility":"pending"})}"
       class="visibility-button\
${parameters.get("visibility", "public")=="pending" and " selected" or "" | n}"
       id="visibility-pending"
       >Pending</a>
    <a href="${query_rewrite({"visibility":"all"})}"
       class="visibility-button\
${parameters.get("visibility", "public")=="all" and " selected" or "" | n}"
       id="visibility-all"
       >All</a>
  </div>
  %endif

  <div id="page">
    ${self.page()}
  </div>

</div>

</div>

<script type="text/javascript" src="${url_root}static/jquery.min.js"></script>
<script type="text/javascript" src="${url_root}static/jquery-ui/jquery-ui.min.js"></script>
<script type="text/javascript" src="${url_root}static/tag-it.js"></script>
<script type="text/javascript" src="${url_root}static/underscore-min.js"></script>
<script type="text/javascript" src="${url_root}static/backbone-min.js"></script>
<script type="text/javascript" src="${url_root}static/markdown.js"></script>
<script type="text/javascript" src="http://maps.google.com/maps/api/js?libraries=geometry&sensor=false"></script>
<script type="text/javascript" src="${url_root}static/mango.js"></script>

<script type="text/javascript">
m.url_root = "${url_root}";
m.urlRoot = "${url_root}";
m.parameters = {
%if "visibility" in parameters:
  visibility: "${parameters["visibility"]}"
%endif
};
</script>

<script type="text/javascript" src="${url_root}static/org.js"></script>

${mini_js | n}


%if footer:

${footer.replace("/render-header-footer.php", uri) | n}

%else:

</body>

</html>

%endif

<%namespace name="mini" file="mini.html" inheritable="True"/>
