<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset=utf-8 />
  <title>${self.title()}</title>
  <link href="data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQEAYAAABPYyMiAAAABmJLR0T///////8JWPfcAAAACXBIWXMAAABIAAAASABGyWs+AAAAF0lEQVRIx2NgGAWjYBSMglEwCkbBSAcACBAAAeaR9cIAAAAASUVORK5CYII=" rel="icon" type="image/x-icon" />
  <link rel="stylesheet" type="text/css" href="/static/style.css" />
  <link rel="stylesheet" type="text/css" href="/static/jquery-ui.css" />
</head>

<body>

  %if messages:
  <table>
    <tbody>
      %for message in messages:
      <tr><td>${message[1]}</td></tr>
      %endfor
    </tbody>
  </table>
  %endif

  <nav>
    <a href="${url_rewrite("/", parameters)}">Home</a>
    <div class="nav-group">
      <a href="${url_rewrite("/organisation", parameters)}">Organisations</a><a href="${url_rewrite("/organisation-tag", parameters)}">Tags</a>
    </div>
    <div class="nav-group">
      <a href="${url_rewrite("/event", parameters)}">Events</a><a href="${url_rewrite("/event-tag", parameters)}">Tags</a>
    </div>
    <a href="${url_rewrite("/note", parameters)}">Notes</a>
    %if current_user:
    |
    <a href="${url_rewrite("/user", parameters)}">Users</a>
    <a href="${url_rewrite("/history", parameters)}">History</a>
    <a href="${url_rewrite("/task/address", parameters)}">Addresses</a>
    %endif
  </nav>
    
  <div id="account">
    %if current_user:
    <a href="${url_rewrite("/user/%d" % current_user.user_id, parameters)}">
      <% hash = current_user.auth.gravatar_hash %>
      <img width="24px" height="24px"
	   src="http://gravatar.com/avatar/${hash}?d=identicon&s=24">
      ${current_user.name}
    </a>
    <a href="/auth/logout?next=${uri}">Log out</a>
    %else:
    <a href="/auth/login?next=${uri}">Log in</a>
    %endif
  </div>

  %if current_user:
  <div id="visibility">
    Visibility:
    <a href="${query_rewrite({"visibility":"public"})}"
       class="visibility-button\
${(parameters.get("visibility", "public")=="public") and " selected" or "" | n}"
       id="visibility-public"
       >Public</a>
    <a href="${query_rewrite({"visibility":"private"})}"
       class="visibility-button\
${parameters.get("visibility", "public")=="private" and " selected" or "" | n}"
       id="visibility-private"
       >Private</a>
    <a href="${query_rewrite({"visibility":"pending"})}"
       class="visibility-button\
${parameters.get("visibility", "public")=="pending" and " selected" or "" | n}"
       id="visibility-pending"
       >Pending</a>
    <a href="${query_rewrite({"visibility":"all"})}"
       class="visibility-button\
${parameters.get("visibility", "public")=="all" and " selected" or "" | n}"
       id="visibility-all"
       >All</a>
  </div>
  %endif

  <div id="page">
    ${self.page()}
  </div>

</div>

<script type="text/javascript" src="/static/jquery.min.js"></script>
<script type="text/javascript" src="/static/jquery-ui.min.js"></script>
<script type="text/javascript" src="/static/markdown.js"></script>
<script type="text/javascript" src="http://maps.google.com/maps/api/js?libraries=geometry&amp;sensor=false"></script>
<script type="text/javascript" src="/static/mango.js"></script>

<script type="text/javascript">
m.parameters = {
%if "visibility" in parameters:
  visibility: "${parameters["visibility"]}"
%endif
};
</script>

${mini_js | n}

</body>

</html>

<%namespace name="mini" file="mini.html" inheritable="True"/>
