<%inherit file="base.html"/>

<%def name="title()">${obj and obj["name"] or "New Organisation"}</%def>

<%def name="page()">

<h1>
  %if obj:
  <a
     href="${url_rewrite(obj["url"], parameters)}"
     >${obj["name"]}</a>
  %else:
  New Organisation
  %endif
</h1>

<div class="section">

  <div id="mango-map-box">
    <div id="mango-map-canvas">Map loading...</div>
  </div>
  
  <div class="form-by-map" id="org-form">
    
    <h3>Organisation</h3>
    
    %if current_user:
    <form action="${obj and obj["url"] or '/organisation'}" method="post">
      <input name="_xsrf" type="hidden" value="${xsrf}">
      %if obj:
      <input name="_method" type="hidden" value="put">
      %endif:
      <label name="name">
	<span>Name</span>
	<span class="requirement">(required)</span>
	<input name="name" value="${obj and obj["name"] or ''}">
      </label>
      
      ${self.mini.visibility_input(obj)}

      <input type="submit">
    </form>
    %endif

    %if obj:
    %if current_user:
    <form action="${obj["url"]}" method="post">
      <input name="_xsrf" type="hidden" value="${xsrf}">
      <input name="_method" type="hidden" value="delete">
      <input type="submit" value="Delete">
    </form>
    %endif

    <div class="action-bar no-border">
      <h3>Tags</h3>

      %if current_user:
      <div class="actions">
        <a
           href="${url_rewrite("%s/tag" % obj["url"], parameters)}"
           class="action"
           >Edit tags</a>
      </div>
      %endif
    </div>

    %if "orgtag_list" in obj:
    <ul class="tag_list">
      %for orgtag in obj["orgtag_list"]:
      ${self.mini.tag_li(
        orgtag, visibility=True, parameters=parameters,
        )}
      %endfor
    </ul>
    %endif
    
    %if "address_list" in obj:
    <div class="action-bar no-border">
      <h3>Addresses</h3>

      %if current_user:
      <div class="actions">
        <a
           href="${url_rewrite("%s/address" % obj["url"], parameters)}"
           class="action"
           >Add an address</a>
      </div>
      %endif
    </div>

    %for address in obj["address_list"]:
    ${self.mini.address_box(
      address,
      "%s%s" % (obj["url"], address["url"]), unlink=True,
      parameters=parameters,
      )}
    %endfor
    %endif

    %endif
  </div>
  
</div>

%if obj and "note_list" in obj:
${self.mini.render_note_section(obj["note_list"],
  obj["url"] + "/note", obj["url"],
  note_search, note_order, unlink_url=obj["url"],
  parameters=parameters,
  )}
%endif

</%def>

