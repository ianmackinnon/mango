<%inherit file="base.html"/>

<%def name="title()">Organisations</%def>

<%def name="page()">

<h1>Organisations</h1>

<ul id="myTags">
</ul>


<div class="action-bar">
  <h3>Filter</h3>
  <form id="org-search">
    ${self.mini.visibility_search_input(parameters.get("visibility", None), current_user)}
    <input type="hidden" name="offset" value="0">
    <label name="nameSearch">
      <span>Name</span>
      <input name="nameSearch" value="${name_search or ""}" placeholder="Eg. BAE Systems">
    </label>
    <label name="lookup">
      <span>Location</span>
      <input name="lookup" value="${lookup or ""}" placeholder="Eg. NW1">
    </label>
    <label name="tag">
      <span>Tags</span>
      <div class="dropdown">
        <ul class="dropdown">
        </ul>
      </div>
      <input
         name="tag"
         value="${tag_name_list and ", ".join([short for short in tag_name_list]) or ""}"
         placeholder="Type to search..."
         >
    </label>
    <input type="submit">
  </form>
</div>

<div id="mango-map-box">
  <div id="mango-map-canvas">Map loading...</div>
</div>

<div class="box right" id="org_list">
<div class="action-bar">
  <div class="counts">
    ${self.mini.counts(
      org_packet["org_list"],
      org_packet.get("offset", 0),
      org_packet["org_count"],
      not lookup and query_rewrite(dict(parameters, **{"offset": org_packet.get("offset", 0) + len(org_packet["org_list"])}))
      )}
  </div>

  %if current_user:
  <ul class="actions">
    <a
       class="action"
       href="${url_rewrite("/organisation/new", parameters)}"
       >Create an organisation</a>
  </ul>
  %endif
</div>

<div class="column">
  %for org in org_packet["org_list"]:
  ${self.mini.org_box(org, geobox=org_packet["geobox"], parameters=parameters) | n}
  %endfor
</div>
</div>

<script type="text/javascript">
org_packet = ${json_dumps(org_packet) | n};
orgtag_list = ${orgtag_list_json | n};
</script>

</%def>

